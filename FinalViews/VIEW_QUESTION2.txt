CREATE VIEW VIEW_QUESTION2
AS 
(
SELECT YEAR, 
       STORENUMBER,
       PROFIT, 
       SALE,
       SUM(SALE) OVER (PARTITION BY YEAR) AS TOTAL_SALES,
       (SALE/TOTAL_SALES) AS RATIO,
       ROUND
      (
        CASE WHEN YEAR = 2013 THEN 500000*(SALE/TOTAL_SALES)
            WHEN YEAR = 2014 THEN 400000*(SALE/TOTAL_SALES)
        END,2) AS BONUS_AMOUNT
      FROM
      (
      SELECT DD.Year, 
              DS.STORENUMBER,
              SUM(FS.SALEAMOUNT) AS SALE, 
              SUM(FS.SALETOTALPROFIT) AS PROFIT
      FROM FACT_SALESACTUAL FS
      INNER JOIN DIM_STORE DS ON FS.DIMSTOREID = DS.DIMSTOREID
      INNER JOIN DIM_PRODUCT DP ON FS.DIMPRODUCTID = DP.DIMPRODUCTID
      INNER JOIN DIM_DATE DD ON FS.DimSaleDateID = DD.DATE_PKEY
      WHERE DP.PRODUCTTYPE LIKE '%Casual' 
        AND STORENUMBER IN (5,8)
        AND LEFT(DIMSALEDATEID,4) IN (2013,2014)
      GROUP BY DD.Year, DS.STORENUMBER
      )
);